== Scan Images in GitLab Container Registry

Use GitLab Personal access token method to authenticate Prisma to access the GitLab Container Registry.

[.task]
=== Create a New Registry Scan

*Prerequisties*

* xref:../../install/deploy-defender/defender_types.adoc[Install a Defender] somewhere in your environment.
* Create a https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html#personal-access-token-scopes[GitLab Personal access token] with at least "read_api" scope permission.
* Create xref:../../authentication/credentials-store/gitlab-credentials.adoc[GitLab credentials using API token].

[.procedure]
. Log in to Console, and select *Defend > Vulnerabilities > Images > Registry settings*.

. Select *Add registry*.
+
image::gitlab-container-registry.png[scale=60]

. In *Add New Registry*, enter the following values:

.. In *Version*, select *Gitlab Container Registry*.

.. In *Repository*, enter the name of the repository to scan, or leave this blank to scan all repositories.

.. Enter *Tag* numbers to scan, leave blank, or enter a wildcard (*) to scan all the tags.

.. Provide at least one of the fields:
... *User ID*: GitLab user account
... *Group ID*: Enter a single group ID, or a list of group IDs
... *Project ID*: Enter a GitLab Project ID, or a list of project IDs
+
NOTE: To scan all the registries, enter only the *User ID*. When Project ID or Group ID are provided, the registry scan will be triggered accordingly. 

.. *Group IDs to exclude- Only top level groups should be set here. When user set top level group to exclude, sub groups will be excluded also.

.. In *Credential*, select the Gitlab access token credentials that you created in the prerequisites section.

.. In *OS type*, specify whether the repo holds *Linux* or *Windows* images.

.. In *Scanners scope*, specify the collections of defenders to use for the scan.
+
Console selects the available Defenders from the scope to execute the scan job according to the *Number of scanners* setting.
For more information, see xref:../../vulnerability_management/registry_scanning/scan_docker_registry_v2.adoc#_deployment_patterns[deployment patterns].

.. In *Number of scanners*, enter the number of Defenders across which scan jobs can be distributed.

.. Set *Cap* to the number of most recent images to scan. Leaving *Cap* set to the default value of *5* will scan the most recent 5 images. Setting this field to *0* will scan all images.

.. Select *Add*.

. Select *Save and scan*.
+
Verify that the images in the repository are being scanned under *Monitor > Vulnerabilities > Images > Registries*.
